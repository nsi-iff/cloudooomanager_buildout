#!${buildout:bin-directory}/${celeryd:interpreter}

from os.path import dirname, abspath, join
from subprocess import call
from argparse import ArgumentParser

ROOT = abspath(dirname(__file__))

def get_args():
    parser = ArgumentParser(description='Start Celery workers.')
    parser.add_argument('-name', dest='name', required=True, type=str, 
                        help='A name for the worker.')
    return parser.parse_args()

def start_worker():
    args = get_args()
    call("%s/celeryd --pidfile=%s --logfile=%s &" % (ROOT, join(ROOT, '..', 'run', args.name+'.pid'),
                                                    join(ROOT, '..', 'log', args.name+'.log')), shell=True)
    
if __name__ == '__main__':
    start_worker()